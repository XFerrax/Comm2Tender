import{d as R,r as b,H as D,t as n,L as d,A as r,z as a,M as s,V as A,aw as S,N as I,o as T,v as Q,O as j,P as q,Q as C,R as E,S as y,T as g,U as P,W as H,X as K,Y as L,Z as U,$ as B,a0 as N,B as M,a1 as O,a2 as z,a3 as W}from"./01VIqO6s.js";import{r as X,l as Y,e as Z,H as h,h as V}from"./SI7jkw24.js";import{m as w,_ as $,a as G,b as J,c as ee,d as te,e as le}from"./BSqYvhTr.js";import{_ as se}from"./C097zIPZ.js";const ie=R({__name:"User",props:w,emits:["update:isActive"],setup(f,{emit:v}){const e=f,m=v,u={requiredRule:X,lengthRule:Y,emailRule:Z},c={max:50},i=b({userId:0,name:"",email:"",password:"",roleId:0,isActive:!1});D(()=>e.editedItem,t=>{var l;i.value.userId=t==null?void 0:t.userId,i.value.name=t==null?void 0:t.name,i.value.email=t==null?void 0:t.email,i.value.password=t==null?void 0:t.password,i.value.roleId=(l=t==null?void 0:t.role)==null?void 0:l.roleId,i.value.isActive=t==null?void 0:t.isActive});const _=()=>{const t={userId:i.value.userId,name:i.value.name,email:i.value.email,password:i.value.password,role:{roleId:i.value.roleId},isActive:i.value.isActive},o=V().BuildQuery(e.isNew?h.post:h.put,t);e.isNew?I(e.apiAddress,o).then(()=>{p()}):I(`${e.apiAddress}/${t.userId}`,t).then(()=>{p()})},p=()=>{m("update:isActive",!1)};return(t,l)=>(n(),d(G,{isActive:e.isActive,"onUpdate:isActive":l[5]||(l[5]=o=>e.isActive=o),"save-func":_,title:e.title,"title-suffix":e.titleSuffix,"close-func":p,"is-new":e.isNew},{fields:r(()=>[a(A,{modelValue:s(i).name,"onUpdate:modelValue":l[0]||(l[0]=o=>s(i).name=o),rules:[u.requiredRule,u.lengthRule(s(i).name,c)],counter:50},{label:r(()=>[a($,{label:"ФИО",required:""})]),_:1},8,["modelValue","rules"]),a(A,{modelValue:s(i).email,"onUpdate:modelValue":l[1]||(l[1]=o=>s(i).email=o),rules:[u.requiredRule,u.emailRule(s(i).email)]},{label:r(()=>[a($,{label:"E-mail",required:""})]),_:1},8,["modelValue","rules"]),a(A,{modelValue:s(i).password,"onUpdate:modelValue":l[2]||(l[2]=o=>s(i).password=o),rules:[u.requiredRule,u.lengthRule(s(i).password,c)],counter:50},{label:r(()=>[a($,{label:"Пароль",required:""})]),_:1},8,["modelValue","rules"]),a(se,{modelValue:s(i).roleId,"onUpdate:modelValue":l[3]||(l[3]=o=>s(i).roleId=o),visible:!0,rules:[u.requiredRule],"api-address":"role","item-title":"name",label:"Роль"},null,8,["modelValue","rules"]),a(S,{modelValue:s(i).isActive,"onUpdate:modelValue":l[4]||(l[4]=o=>s(i).isActive=o),label:"Активация учетной записи"},null,8,["modelValue"])]),_:1},8,["isActive","title","title-suffix","is-new"]))}}),x="user",ae="Пользователи",oe="пользователя",re=R({__name:"User",props:J,setup(f){var v=f;const e=ee(),m=V(),u=`${x}Id`,c=b([{title:"ID пользователя",key:u,align:"end",sortable:!0},{title:"ФИО",key:"name",align:"start",sortable:!0},{title:"E-mail",key:"email",align:"start",sortable:!0},{title:"Роль",key:"role.name",align:"start",sortable:!0},{title:"Активация",key:"isActive",align:"center",sortable:!1}]);v.readonly||c.value.push({title:"Действия",key:"actions",align:"center",sortable:!1}),T(()=>i());const i=()=>{if(!e.loading.value){e.mixinBeforeRequest();const t=m.BuildQuery(h.post,m.getListRequest({pagination:e.pagination.value,search:e.search.value}));I(`${x}/search`,t).then(l=>{e.items=b(l.items),e.total=l.total,e.mixinAfterRequest(!0)})}},_=()=>{const t=m.BuildQuery(h.delete);I(`${x}/${e.editedItem.value.userId}`,t).then(l=>{e.items=b(l.items),e.total=l.total,e.mixinAfterRequest(!0)})},p=()=>{e.isNew.value=!0,e.isForm.value=!0};return(t,l)=>(n(),Q(W,null,[t.visible?(n(),d(z,{key:0,wrap:""},{default:r(()=>[a(O,{title:ae,flat:"",width:"100%"},{text:r(()=>[a(j,null,{default:r(()=>[a(q,null,{default:r(()=>[a(C,{class:"d-flex justify-center",cols:"6"},{default:r(()=>[t.hideSearch?y("",!0):(n(),d(A,{key:0,modelValue:s(e).search.value,"onUpdate:modelValue":l[0]||(l[0]=o=>s(e).search.value=o),label:"Поиск","prepend-icon":"mdi-magnify","single-line":"","hide-details":"",clearable:"",onKeydown:E(i,["enter"])},null,8,["modelValue"]))]),_:1}),a(C,{class:"d-flex justify-center"},{default:r(()=>[t.hideSearch?y("",!0):(n(),d(g,{key:0,disabled:s(e).loading.value,"prepend-icon":"mdi-refresh",class:"align-self-center",text:"Поиск",onClick:i},null,8,["disabled"]))]),_:1}),a(P),a(C,{class:"d-flex justify-center"},{default:r(()=>[("readonly"in t?t.readonly:s(H))?y("",!0):(n(),d(g,{key:0,color:"primary","prepend-icon":"mdi-plus",class:"align-self-center",onClick:p,text:"Добавить"}))]),_:1})]),_:1})]),_:1})]),default:r(()=>[a(K),a(L,{modelValue:s(e).selected,"onUpdate:modelValue":l[1]||(l[1]=o=>s(e).selected=o),"show-select":t.selectMulti,headers:c.value,items:s(e).items.value,"footer-props":{"Элементов на странице":10},options:s(e).pagination,"server-items-length":s(e).total,loading:s(e).loading.value,"item-key":u},{"item.isActive":r(({item:o})=>[a(U,{icon:o.isActive?"mdi-check-circle-outline":"mdi-close-circle-outline",color:o.isActive?"green":"red"},null,8,["icon","color"])]),"item.actions":r(({item:o})=>[a(q,{"no-gutters":"",align:"center",justify:"center",class:"flex-nowrap"},{default:r(()=>[a(B,{location:"bottom","open-delay":1e3,"close-delay":0,text:"Редактировать"},{activator:r(({props:k})=>[a(g,N({density:"comfortable",icon:"",class:"mx-1",variant:"tonal",color:"primary"},k,{onClick:F=>s(e).mixinEditItem(o)}),{default:r(()=>[a(U,null,{default:r(()=>[M("mdi-pencil")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),a(B,{location:"bottom","open-delay":1e3,"close-delay":0,text:"Удалить"},{activator:r(({props:k})=>[a(g,N({density:"comfortable",icon:"",class:"mx-1",variant:"tonal",color:"error"},k,{onClick:F=>s(e).mixinDeleteItem(o)}),null,16,["onClick"])]),_:2},1024)]),_:2},1024)]),"no-data":r(()=>[a(te,{text:"Нет данных",icon:"mdi-alert-circle-outline",outlined:""})]),_:2},1032,["modelValue","show-select","headers","items","options","server-items-length","loading"])]),_:1})]),_:1})):y("",!0),a(ie,{isActive:s(e).isForm.value,"onUpdate:isActive":l[2]||(l[2]=o=>s(e).isForm.value=o),"title-suffix":oe,"is-new":s(e).isNew.value,"edited-item":s(e).editedItem,"api-address":x},null,8,["isActive","is-new","edited-item"]),a(le,{isOpen:s(e).isDialogConfirm.value,onConfirm:_,onCancel:l[3]||(l[3]=o=>s(e).isDialogConfirm.value=!1)},null,8,["isOpen"])],64))}}),ce=R({__name:"users",setup(f){return(v,e)=>(n(),d(re))}});export{ce as default};
