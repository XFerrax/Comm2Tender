import{d as C,r as f,g as B,t as d,L as m,A as n,z as l,M as i,V as g,N as I,o as F,v as N,O as T,P as w,Q as D,R as Q,S as V,T as k,U as j,W as P,X as K,Y as L,Z as $,$ as h,a0 as q,B as M,a1 as O,a2 as E,a3 as H}from"./01VIqO6s.js";import{r as z,l as W,e as X,H as R,h as S}from"./SI7jkw24.js";import{m as Y,_ as b,a as Z,b as G,c as J,d as ee,e as te}from"./BSqYvhTr.js";const ae=C({__name:"Agent",props:Y,emits:["update:isActive"],setup(v,{emit:y}){const e=v,c=y,u={requiredRule:z,lengthRule:W,emailRule:X},p=f(e.isActive),t=f({agentId:0,name:"",agentRegistrationDate:null,agentSystemRegistrationDate:null,ogrn:0,inn:0,kpp:0});e.editedItem&&(t.value.agentId=e.editedItem.agentId,t.value.name=e.editedItem.name,t.value.agentRegistrationDate=e.editedItem.agentRegistrationDate,t.value.agentSystemRegistrationDate=e.editedItem.agentSystemRegistrationDate,t.value.ogrn=e.editedItem.role.ogrn,t.value.inn=e.editedItem.inn,t.value.kpp=e.editedItem.kpp);const A=()=>{const o={agentId:t.value.agentId,name:t.value.name,agentRegistrationDate:t.value.agentRegistrationDate,agentSystemRegistrationDate:t.value.agentSystemRegistrationDate,ogrn:t.value.ogrn,inn:t.value.inn,kpp:t.value.kpp},s=S().BuildQuery(e.isNew?R.post:R.put,o);e.isNew?I(e.apiAddress,s).then(()=>{p.value=!1}):I(`${e.apiAddress}/${o.agentId}`,o).then(()=>{p.value=!1})},_=()=>{c("update:isActive",!1)};return(o,a)=>{const s=B("VDateInput");return d(),m(Z,{isActive:e.isActive,"onUpdate:isActive":a[5]||(a[5]=r=>e.isActive=r),"save-func":A,title:e.title,"title-suffix":e.titleSuffix,"close-func":_,"is-new":e.isNew},{fields:n(()=>[l(g,{modelValue:i(t).name,"onUpdate:modelValue":a[0]||(a[0]=r=>i(t).name=r),rules:[u.requiredRule],counter:50},{label:n(()=>[l(b,{label:"Название контрагента",required:""})]),_:1},8,["modelValue","rules"]),l(s,{modelValue:i(t).agentRegistrationDate,"onUpdate:modelValue":a[1]||(a[1]=r=>i(t).agentRegistrationDate=r),label:"Выберите дату регистрации контрагента"},null,8,["modelValue"]),l(g,{modelValue:i(t).ogrn,"onUpdate:modelValue":a[2]||(a[2]=r=>i(t).ogrn=r),rules:[u.requiredRule]},{label:n(()=>[l(b,{label:"ОГРН",required:""})]),_:1},8,["modelValue","rules"]),l(g,{modelValue:i(t).inn,"onUpdate:modelValue":a[3]||(a[3]=r=>i(t).inn=r),rules:[u.requiredRule],counter:50},{label:n(()=>[l(b,{label:"ИНН",required:""})]),_:1},8,["modelValue","rules"]),l(g,{modelValue:i(t).kpp,"onUpdate:modelValue":a[4]||(a[4]=r=>i(t).kpp=r),rules:[u.requiredRule],counter:50},{label:n(()=>[l(b,{label:"КПП",required:""})]),_:1},8,["modelValue","rules"])]),_:1},8,["isActive","title","title-suffix","is-new"])}}}),x="agent",le="Контрагенты",ie="контрагента",ne=C({__name:"Agent",props:G,setup(v){var y=v;const e=J(),c=S(),u=`${x}Id`,p=f([{title:"ID агента",key:u,align:"end",sortable:!0},{title:"Название",key:"name",align:"start",sortable:!0},{title:"ИНН",key:"inn",align:"start",sortable:!0},{title:"КПП",key:"kpp",align:"start",sortable:!0},{title:"ОГРН",key:"ogrn",align:"start",sortable:!0},{title:"Дата регистрации",key:"agentRegistrationDate",align:"start",sortable:!0}]);y.readonly||p.value.push({title:"Действия",key:"actions",align:"center",sortable:!1}),F(()=>t());const t=()=>{if(!e.loading.value){e.mixinBeforeRequest();const o=c.BuildQuery(R.post,c.getListRequest({pagination:e.pagination.value,search:e.search.value}));I(`${x}/search`,o).then(a=>{e.items=f(a.items),e.total=a.total,e.mixinAfterRequest(!0)})}},A=()=>{const o=c.BuildQuery(R.delete);I(`${x}/${e.editedItem.value.agentId}`,o).then(a=>{e.items=f(a.items),e.total=a.total,e.mixinAfterRequest(!0)})},_=()=>{e.isNew.value=!0,e.isForm.value=!0};return(o,a)=>(d(),N(H,null,[o.visible?(d(),m(E,{key:0,wrap:""},{default:n(()=>[l(O,{title:le,flat:"",width:"100%"},{text:n(()=>[l(T,null,{default:n(()=>[l(w,null,{default:n(()=>[l(D,{class:"d-flex justify-center",cols:"6"},{default:n(()=>[o.hideSearch?V("",!0):(d(),m(g,{key:0,modelValue:i(e).search.value,"onUpdate:modelValue":a[0]||(a[0]=s=>i(e).search.value=s),label:"Поиск","prepend-icon":"mdi-magnify","single-line":"","hide-details":"",clearable:"",onKeydown:Q(t,["enter"])},null,8,["modelValue"]))]),_:1}),l(D,{class:"d-flex justify-center"},{default:n(()=>[o.hideSearch?V("",!0):(d(),m(k,{key:0,disabled:i(e).loading.value,"prepend-icon":"mdi-refresh",class:"align-self-center",text:"Поиск",onClick:t},null,8,["disabled"]))]),_:1}),l(j),l(D,{class:"d-flex justify-center"},{default:n(()=>[("readonly"in o?o.readonly:i(P))?V("",!0):(d(),m(k,{key:0,color:"primary","prepend-icon":"mdi-plus",class:"align-self-center",onClick:_,text:"Добавить"}))]),_:1})]),_:1})]),_:1})]),default:n(()=>[l(K),l(L,{modelValue:i(e).selected,"onUpdate:modelValue":a[1]||(a[1]=s=>i(e).selected=s),"show-select":o.selectMulti,headers:p.value,items:i(e).items.value,"footer-props":{"Элементов на странице":10},options:i(e).pagination,"server-items-length":i(e).total,loading:i(e).loading.value,"item-key":u},{"item.isActive":n(({item:s})=>[l($,{icon:s.isActive?"mdi-check-circle-outline":"mdi-close-circle-outline",color:s.isActive?"green":"red"},null,8,["icon","color"])]),"item.actions":n(({item:s})=>[l(w,{"no-gutters":"",align:"center",justify:"center",class:"flex-nowrap"},{default:n(()=>[l(h,{location:"bottom","open-delay":1e3,"close-delay":0,text:"Редактировать"},{activator:n(({props:r})=>[l(k,q({density:"comfortable",icon:"",class:"mx-1",variant:"tonal",color:"primary"},r,{onClick:U=>i(e).mixinEditItem(s)}),{default:n(()=>[l($,null,{default:n(()=>[M("mdi-pencil")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),l(h,{location:"bottom","open-delay":1e3,"close-delay":0,text:"Удалить"},{activator:n(({props:r})=>[l(k,q({density:"comfortable",icon:"",class:"mx-1",variant:"tonal",color:"error"},r,{onClick:U=>i(e).mixinDeleteItem(s)}),null,16,["onClick"])]),_:2},1024)]),_:2},1024)]),"no-data":n(()=>[l(ee,{text:"Нет данных",icon:"mdi-alert-circle-outline",outlined:""})]),_:2},1032,["modelValue","show-select","headers","items","options","server-items-length","loading"])]),_:1})]),_:1})):V("",!0),l(ae,{isActive:i(e).isForm.value,"onUpdate:isActive":a[2]||(a[2]=s=>i(e).isForm.value=s),"title-suffix":ie,"is-new":i(e).isNew.value,"edited-item":i(e).editedItem,"api-address":x},null,8,["isActive","is-new","edited-item"]),l(te,{isOpen:i(e).isDialogConfirm.value,onConfirm:A,onCancel:a[3]||(a[3]=s=>i(e).isDialogConfirm.value=!1)},null,8,["isOpen"])],64))}}),ue=C({__name:"agents",setup(v){return(y,e)=>(d(),m(ne))}});export{ue as default};
